{% extends 'common/base.html' %}
{% load static %}

{% block content %}

<br>
{% for message in messages %}
<div class="alert {{message.tags}} alert-dismissible" role="alert">
    {{ message }}
    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
</div>
{% endfor %}

<a href="{% url 'new_sale' %}" class="btn btn-primary">Добавить продажу</a>
<br>
<br>
<table class="table table-striped table-hover table_sort">
    <thead class="table-dark non-select">
    <tr>
        <th scope="col">ID</th>
        <th scope="col">Наименование товара</th>
        <th scope="col">Закуп. цена (рубли)</th>
        <th scope="col">Рознич. цена (рубли)</th>
        <th scope="col">Количество</th>
        <th scope="col">Общая прибыль (рубли)</th>
        <th scope="col">Чистая прибыль (рубли)</th>
        <th scope="col">Размер скидки</th>
        <th scope="col">Телефон</th>
        <th scope="col">Дата</th>
    </tr>
    </thead>
    <tbody>
    {% for sale in sales %}
    <tr>
        <td scope="row"><a href="{{ sale.get_absolute_url }}">{{sale.id}}</a></td>
        <td><a href="{{sale.product.get_absolute_url}}">{{sale.product.name}}</a></td>
        <td>{{sale.product.purchase_price|floatformat:"2"}}</td>
        <td>{{sale.product.retail_price|floatformat:"2"}}</td>
        <td>{{sale.quantity}}</td>
        <td>{{sale.get_total_score|floatformat:"2"}}</td>
        <td>{{sale.get_clean_total_score|floatformat:"2"}}</td>

        {% if sale.discount %}
            <td>{{sale.discount|floatformat:"0"}} %</td>
        {% else %}
            <td>&#8722;</td>
        {% endif %}
        {% if sale.customer_phone %}
            <td>{{sale.customer_phone}}</td>
        {% else %}
            <td>&#8722;</td>
        {% endif %}

        <td>{{sale.created_at|date:"j-m-Y"}}</td>
    </tr>
    {% endfor %}
    </tbody>
</table>

{% endblock %}